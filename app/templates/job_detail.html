{% extends "base.html" %}

{% block content %}
  <div class="flex items-start justify-between gap-4">
    <div>
      <h1 class="text-2xl font-semibold">Job</h1>
      <div class="mt-1 text-slate-700">{{ job.topic }}</div>
    </div>
    <div class="text-right space-x-2">
      {% if job.status == "completed" and job.output_path %}
        <a class="bg-slate-900 text-white rounded px-4 py-2 hover:bg-slate-800" href="/jobs/{{ job.id }}/read" target="_blank" rel="noreferrer">Read</a>
        <a class="bg-slate-700 text-white rounded px-4 py-2 hover:bg-slate-800" href="/jobs/{{ job.id }}/download.pdf">Download PDF</a>
      {% endif %}

      {% if job.status == "running" %}
        <form class="inline" method="post" action="/jobs/{{ job.id }}/stop">
          <button class="bg-amber-500 text-white rounded px-3 py-2 hover:bg-amber-600" type="submit">Stop</button>
        </form>
      {% endif %}

      {% if job.status in ["queued", "running", "stopped"] %}
        <form class="inline" method="post" action="/jobs/{{ job.id }}/cancel">
          <button class="bg-rose-600 text-white rounded px-3 py-2 hover:bg-rose-700" type="submit">Cancel</button>
        </form>
      {% endif %}

      {% if job.status == "stopped" %}
        <form class="inline" method="post" action="/jobs/{{ job.id }}/resume">
          <button class="bg-emerald-600 text-white rounded px-3 py-2 hover:bg-emerald-700" type="submit">Resume</button>
        </form>
      {% endif %}

      {% if job.status in ["failed", "cancelled"] %}
        <form class="inline" method="post" action="/jobs/{{ job.id }}/retry">
          <button class="bg-indigo-600 text-white rounded px-3 py-2 hover:bg-indigo-700" type="submit">Retry</button>
        </form>
      {% endif %}
    </div>
  </div>

  <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
    <div class="bg-white rounded-lg shadow p-4"
         hx-get="/jobs/{{ job.id }}/partials/status"
         hx-trigger="load, every 2s"
         hx-swap="outerHTML">
      {% include "partials/job_status.html" %}
    </div>

    <div class="bg-white rounded-lg shadow p-4"
         hx-get="/jobs/{{ job.id }}/partials/events"
         hx-trigger="load, every 2s"
         hx-swap="outerHTML">
      {% include "partials/job_events.html" %}
    </div>
  </div>
{% endblock %}
